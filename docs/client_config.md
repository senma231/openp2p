# OpenP2P 客户端配置指南

## 配置文件说明

OpenP2P客户端使用JSON格式的配置文件，以下是各字段的详细说明：

```json
{
  "server": "openp2p.example.com",  // 服务器地址，必填
  "port": 27183,                    // 服务器端口，默认27183
  "name": "Office",                 // 节点名称，建议填写，方便识别
  "token": "xxxxxxxxxxxxxxxx",      // 节点令牌，必填，用于身份验证
  "bind": "0.0.0.0",                // 绑定地址，默认0.0.0.0
  "p2p_port": 0,                    // P2P端口，0表示随机选择
  "log_level": 2,                   // 日志级别：0=关闭，1=错误，2=信息，3=调试
  "auto_start": true,               // 是否自动启动
  "auto_login": true,               // 是否自动登录
  "language": "zh_CN",              // 界面语言
  "theme": "light"                  // 界面主题
}
```

### 重要说明

1. **username和password字段**：这两个字段在新版本中已不再需要，可以从配置文件中移除。身份验证现在完全通过token进行。

2. **name字段**：虽然不是必须的，但强烈建议设置。它帮助您在管理界面中识别不同的节点。服务器会通过token匹配到对应的节点，但如果name与服务器上注册的节点名称不匹配，系统会记录警告日志。

3. **token字段**：这是必填字段，用于身份验证和节点匹配。您需要先在管理后台创建节点并获取token，然后在客户端配置中使用。

## 客户端启动与连接

启动客户端后，您可能会看到类似以下的日志：

```
2025/03/17 09:18:08 Running in development mode
2025/03/17 09:18:08 Starting HTTP server on port 27183 in production mode
```

这表明客户端已经启动，但没有显示与服务器的连接状态。要查看更详细的连接日志，您可以：

1. 将`log_level`设置为`3`（调试级别）
2. 查看客户端日志文件，通常位于：
   - Windows: `%APPDATA%\OpenP2P\logs\`
   - Linux: `~/.openp2p/logs/`
   - macOS: `~/Library/Application Support/OpenP2P/logs/`

## 功能说明

### P2P隧道与网络分段

1. **原始OpenP2P项目**：使用P2P隧道打洞，设备之间进行组网，并分配独立网段。

2. **当前版本**：
   - 保留了P2P隧道打洞功能，允许不同网络环境下的设备直接通信
   - 简化了网络分段配置，不再要求用户手动配置网段
   - 增强了NAT穿透能力，支持更多复杂网络环境
   - 添加了中继服务器功能，当P2P连接失败时自动切换到中继模式

3. **网络分段**：在当前版本中，网络分段是可选的。如果您需要创建虚拟局域网，可以在高级设置中启用此功能。对于大多数端口映射和远程访问场景，不需要配置网络分段。

## 故障排除

如果客户端无法连接到服务器，请检查：

1. 服务器地址和端口是否正确
2. Token是否与服务器上注册的节点匹配
3. 防火墙是否允许客户端访问服务器
4. 网络连接是否稳定

如需更多帮助，请查看日志文件或联系管理员。 